<!doctype html><html lang=en><head><meta charset=utf-8><title>[新機能] Cloud Build Trigger が指定した時間に実行( Run on schedule )出来るようになったので試してみる</title><script async src="https://www.googletagmanager.com/gtag/js?id=UA-XXXXXXXX-XX"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','UA-XXXXXXXX-XX');</script><script data-goatcounter=https://iganari.github.io/count async src=//iganari.github.io/count.js></script><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><link rel=alternate type=application/rss+xml href=https://iganari.github.io/index.xml title="Escape from"><meta name=twitter:card content="summary"><meta name=twitter:title content="[新機能] Cloud Build Trigger が指定した時間に実行( Run on schedule )出来るようになったので試してみる"><meta name=twitter:description content="Cloud Build の追加機能を試してみました :)"><link rel=stylesheet href=https://iganari.github.io/fontawesome/css/all.min.css><link id=dark-mode-theme rel=stylesheet href=https://iganari.github.io/css/dark.css><script>var darkTheme=document.getElementById('dark-mode-theme')
var storedTheme=localStorage.getItem('dark-mode-storage')
if(storedTheme==='dark'){darkTheme.disabled=false}else if(storedTheme==='light'){darkTheme.disabled=true}</script><script src=https://iganari.github.io/js/bundle.js></script><script src=https://iganari.github.io/js/instantpage.min.js type=module defer></script><meta name=generator content="Hugo 0.79.1"></head><body><header><nav class=navbar><div class=nav><a href=https://iganari.github.io/ class=nav-logo><img src=https://iganari.github.io/images/icon.png width=50 height=50 alt=Logo></a><ul class=nav-links><li><a href=/about/ id=About><em class="fas fa-user fa-lg"></em></a></li><li><a href=/tags id=Tags><em class="fas fa-tag fa-lg"></em></a></li><li><a href=/search id=Search><em class="fas fa-search fa-lg"></em></a></li><li><a href=/archives id=Archives><em class="fas fa-archive fa-lg"></em></a></li></ul></div></nav><div class=intro-header><div class=container><div class=post-heading><h1>[新機能] Cloud Build Trigger が指定した時間に実行( Run on schedule )出来るようになったので試してみる</h1><span class=meta-post><em class="fa fa-calendar-alt"></em>&nbsp;Feb 15, 2021</span></div></div></div></header><div class=container role=main><article class=article class=blog-post><p>Cloud Build の追加機能を試してみました :)</p><hr><h1 id=注意点>注意点</h1><p>この記事は下記の記事のアーカイブです ;)</p><p><a href=https://iganari.hatenablog.com/entry/2021/02/15/234246>https://iganari.hatenablog.com/entry/2021/02/15/234246</a></p><h1 id=概要>概要</h1><p>Cloud Build の Trigger を指定した時間に実行する機能が追加実装されました。</p><p>その機能をさっそく使ってみようと思います :)</p><p>なお、 2021 年 2 月の時点では <code>Preview</code> となっています。</p><h3 id=cloud-build-とは>Cloud Build とは</h3><p>GCP のフルマネージドの CI/CD 基盤であり、昨今の DevOps には欠かせない機能の一つです。</p><p><a href=https://cloud.google.com/build>Cloud Build</a></p><h3 id=今回の追加機能について>今回の追加機能について</h3><p>今までは Cloud Build を実行するトリガーは、連携している Repository に対してのイベントをフックするか、 API 的に外部から実行するしかありませんでした。</p><p>新しい追加機能は Cloud Build から Cloud Scheduler を直接設定することが出来るようになりました。</p><p>つまり…</p><p>今まで、 Cloud Build を定期実行させたい場合は自分で以下の構成をする必要がありました。</p><ul><li><code>Cloud Scheduler</code> -> <code>Cloud Pub/Sub</code> -> <code>Cloud Functions</code> -> <code>Cloud Build</code></li></ul><figure><img src=/images/2021/02/15/01.png></figure><p>今回の追加機能では以下のよう(※ ユーザが実装する部分という意味で)になります。</p><ul><li><code>Cloud Scheduler</code> -> <code>Cloud Build</code></li></ul><figure><img src=/images/2021/02/15/02.png></figure><p>意識して管理するコンポーネントが減るので運用負荷が減り、サービス開発においても出来ることが増えるので、早めに習得しておきましょう :)</p><h3 id=公式ドキュメント>公式ドキュメント</h3><p><a href=https://cloud.google.com/build/docs/automating-builds/create-manual-triggers#scheduling_your_build>Creating manual triggers | Scheduling your build</a></p><h1 id=実際にやってみる>実際にやってみる</h1><h1 id=cloud-build-trigger-を作成>Cloud Build Trigger を作成</h1><h3 id=gcp-コンソールより-cloud-build-をクリック>GCP コンソールより、 <code>Cloud Build</code> をクリック</h3><figure><img src=/images/2021/02/15/03.png></figure><h3 id=cloud-build-の-api-を有効化する初回のみ>Cloud Build の API を有効化する(初回のみ)</h3><figure><img src=/images/2021/02/15/04.png></figure><h3 id=cloud-build-の画面-history->Cloud Build の画面( History )</h3><figure><img src=/images/2021/02/15/05.png></figure><h3 id=cloud-build-の画面-triggers--に移動し-create-trigger-をクリック>Cloud Build の画面( Triggers ) に移動し、 <code>CREATE TRIGGER</code> をクリック</h3><figure><img src=/images/2021/02/15/06.png></figure><h3 id=テスト的に-trigger-を作成する>テスト的に Trigger を作成する</h3><ul><li>Name : <code>run-schedule-test</code> を記入</li><li>Event: <code>Manual invocation</code> を選択</li><li>Source: <code>cloudbuild.yaml が入っている リポジトリ</code><ul><li>サンプルとして下記のソースコードを使用しています</li><li><a href=https://github.com/iganari/package-gcp/tree/main/builds/sample>GitHub: package-gcp/builds/sample</a></li></ul></li></ul><p>他の設定はデフォルトのままで。</p><p>設定を入れたら <code>CREATE</code> をクリック</p><figure><img src=/images/2021/02/15/07.png></figure><h3 id=cloud-build-trigger-の作成が完了したので-run-をクリック>Cloud Build Trigger の作成が完了したので <code>RUN</code> をクリック</h3><figure><img src=/images/2021/02/15/08.png></figure><h3 id=main-ブランチを選択し-trigger-を実行>main ブランチを選択し、 Trigger を実行</h3><figure><img src=/images/2021/02/15/09.png></figure><h3 id=history-をクリックし実際の実行結果を確認するために実行中の-build-をクリック><code>History</code> をクリックし、実際の実行結果を確認するために実行中の Build をクリック</h3><figure><img src=/images/2021/02/15/10.png></figure><h3 id=build-の内容を確認し正常に実行出来ているかを確認する>Build の内容を確認し、正常に実行出来ているかを確認する</h3><figure><img src=/images/2021/02/15/11.png></figure><h1 id=作成した-cloud-build-trigger-を定期実行するように設定する>作成した Cloud Build Trigger を定期実行するように設定する</h1><h3 id=cloud-scheduler-の-api-を有効化する>Cloud Scheduler の API を有効化する</h3><p>下記の URL を別タブで開き、 Cloud Scheduler の API を有効化する</p><p><a href=https://console.cloud.google.com/marketplace/product/google/cloudscheduler.googleapis.com>https://console.cloud.google.com/marketplace/product/google/cloudscheduler.googleapis.com</a></p><figure><img src=/images/2021/02/15/12.png></figure><h3 id=作成した-trigger-のケバブメニュー縦に3つの点があるボタンをクリック>作成した Trigger のケバブメニュー(縦に3つの点があるボタン)をクリック</h3><figure><img src=/images/2021/02/15/13.png></figure><h3 id=run-on-schedule-をクリック><code>Run on schedule</code> をクリック</h3><figure><img src=/images/2021/02/15/14.png></figure><h3 id=cloud-scheduler-で使用する-service-account-を選択し-continue-をクリック>Cloud Scheduler で使用する Service Account を選択し、 <code>CONTINUE</code> をクリック</h3><p>デフォルトで選択されているものを使用する</p><figure><img src=/images/2021/02/15/15.png></figure><h3 id=cloud-scheduler-を実行するリージョンを選択するために-set-region-をクリック>Cloud Scheduler を実行するリージョンを選択するために、 <code>SET REGION</code> をクリック</h3><figure><img src=/images/2021/02/15/16.png></figure><h3 id=cloud-scheduler-を実行するリージョンを選択する>Cloud Scheduler を実行するリージョンを選択する</h3><p><code>asia-northeast1</code> を選択</p><figure><img src=/images/2021/02/15/17.png></figure><h3 id=cloud-scheduler-の設定をする>Cloud Scheduler の設定をする</h3><ul><li>Name : <code>Cloud Scheduler の Job 名</code></li><li>Frequency: <code>繰り返しの設定</code></li><li>TimeZone: <code>繰り返しの設定のタイムゾーン</code></li></ul><p>今回は 5 分毎に実行するように設定する</p><figure><img src=/images/2021/02/15/18.png></figure><h3 id=作成完了>作成完了</h3><figure><img src=/images/2021/02/15/19.png></figure><h3 id=history-をクリックし定期実行されるのを待つ>History をクリックし、定期実行されるのを待つ</h3><figure><img src=/images/2021/02/15/20.png></figure><h3 id=1-時間くらい待った結果ちゃんと-5-分毎に実行されているのが分かる>1 時間くらい待った結果、ちゃんと 5 分毎に実行されているのが分かる</h3><figure><img src=/images/2021/02/15/21.png></figure><h1 id=まとめ>まとめ</h1><p>今回は Cloud Build の追加機能を試してみました。</p><p>サービス開発がより効率的に出来るようになるので、 GA (General Availability) が楽しみですね!!</p><p>なお繰り返しになりますが、この記事を書いている時点ではこの追加機能は Preview なので、ご利用は自己責任かつ計画的にお願いします。</p><p>Have fun !! :)</p><div class=blog-tags><a href=https://iganari.github.io/tags/gcp/>GCP</a>&nbsp;
<a href=https://iganari.github.io/tags/cloud-build/>Cloud Build</a>&nbsp;
<a href=https://iganari.github.io/tags/cloud-scheduler/>Cloud Scheduler</a>&nbsp;</div></article><div id=disqus_thread></div><script type=text/javascript>(function(){if(window.location.hostname=="localhost")return;var dsq=document.createElement('script');dsq.type='text/javascript';dsq.async=true;var disqus_shortname='yourdisqusshortname';dsq.src='//'+disqus_shortname+'.disqus.com/embed.js';(document.getElementsByTagName('head')[0]||document.getElementsByTagName('body')[0]).appendChild(dsq);})();</script><noscript>Please enable JavaScript to view the
<a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com/ class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div><footer><div><a href=https://twitter.com/iganari_ name=twitter><em class="fab fa-twitter"></em></a><a href=https://github.com/iganari name=github><em class="fab fa-github"></em></a><a href=https://www.linkedin.com/in/iganari/ name=LinkedIn><em class="fab fa-linkedin-in"></em></a><a href=link%20to%20social%20media name="name of social media"><em class="A icon from https://fontawesome.com/"></em></a><div class=container><p class="credits copyright"><a href=https://iganari.github.io/about>iganari</a>
&nbsp;&copy;
2021
&nbsp;/&nbsp;
<a href=https://iganari.github.io/>Escape from</a>
&nbsp;&ndash;&nbsp;
<em class="fas fa-moon" id=dark-mode-toggle></em></p><p class="credits theme-by">Powered By <a href=https://gohugo.io>Hugo</a>&nbsp;
Theme
<a href=https://github.com/matsuyoshi30/harbor>Harbor</a></p></div></footer></body></html>